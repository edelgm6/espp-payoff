{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ESPP Payoff</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  </head>
  <body>
    <div class="container">

      <div class="row">
        <div class="col-md-5">
        {% include "espp-form.html" %}
        </div>
      </div>

      <div class="row">
      <div class="col-md-12">
        <h1>What is your ESPP worth?</h1>
        <p>Many companies offer an Employee Stock Purchase plan — the option to buy shares in the company at at a 15% discount
          to the price at the beginning or the end of the purchase period.</p>
        <p>This seems like a good deal — but <b>how good of a deal is it?</b> Put another way, if we went to Goldman Sachs
          and told them that we wanted them to sell us a security that behaved like an ESPP, how much would it cost?
          That's what we're going to find out.</p>
      </div>
      </div>

      <h2>Understanding the payoff chart</h2>

      <div class="col-md-12">
      <div class="row">
      <div class="col-sm-5">
        <p>An Employee Stock Purchase Plan (ESPP) typically has the following features:
        <ul>
          <li>Purchase limit: Purchase your company's stock up to the lower of —</li>
            <ul>
              <li>$12,500</li>
              <li>1000 shares</li>
            </ul>
          <li>Purchase price: Purchase your company's stock at price of the lower of:
          <ul>
            <li>85% of the price at the <strong>beginning</strong> of the period</li>
            <li>85% of the price at the <strong>end</strong> of the period</li>
          </ul>
        </ul>
        That system creates a payoff chart like what we have to the right — from, $0, it <strong>increases by $150 per dollar in share
        price</strong>, then flattens out until it hits the <strong>price at the beginning of the offering period</strong>
        and then increases <strong>proportionately to the increase in stock price</strong> relative to the current price.

        If that's confusing don't worry — we'll go through it step by step.
        </p>
      </div>

      <div class="col-md-7">
      <canvas id="payoff-example"></canvas>
      </div>
      </div>

      <hr>


      <div class="row">
      <div class="col-sm-5">
        <p>The leftmost section of the chart represents stock prices that <strong>are low enough
          to hit the 1000 shares purchase limit</strong>, i.e., when you cannot invest the entire
          $12,500. Given the 15% purchase discount, this limit kicks in at $12.50 / .85, or $14.70.
          At this point, each dollar change in the stock price drives a $150 change in the payoff.
          E.g., at $5, you purchase 1000 shares for $4.25 (i.e., the 85% discount), locking in a
          gain of $750 (i.e., 5 x $150).
      </div>
      <div class="col-md-7">
      <canvas id="shares-cap-example"></canvas>
      </div>
      </div>

      <hr>

      <div class="row">
      <div class="col-sm-5">
        <p>The simplest part of the payoff chart to understand is the flat part in the middle. This represents the stock prices where:
          <ul>
            <li>The stock price at the end of the offering period is less than the stock price at the beginning of the offering period</li>
            <li>And the stock price is still high enough that you can invest the entire $12,500 (i.e., you don't hit the 1000 share limit)</li>
          </ul>
          In this case, you will invest $12,500 at an 85% discount to the current stock price, yielding a ~17% return, or ~$2205 gain.
        </p>
      </div>
      <div class="col-md-7">
      <canvas id="middle-example"></canvas>
      </div>
      </div>

      <hr>

      <div class="row">
      <div class="col-sm-5">
        <p>The rightmost section of the chart represents stock prices where <strong>the
          price at the end of the period is greater than the price at the beginning of the period.</strong>
          To understand why, consider our original example:
          <ul>
            <li>Stock price is $28 at the beginning of the purchase period</li>
            <li>Stock price is $34 at the end of the purchase period</li>
            <li>You buy $12,500 worth of stock at a 15% discount <strong>to the $28
              starting price</strong> since it is lower than the ending price</li>
            <li>You get a return of (($34 - .85 * $28) / .85 * $28) * $12,500, or $5357</li>
          </ul>
      </div>
      <div class="col-md-7">
      <canvas id="upside-example"></canvas>
      </div>
      </div>


      <h2>Creating a replicating portfolio</h2>
      <p>We know what the payoff looks like, but now we need to put a value on that payoff. Enter
        the <strong>replicating portfolio.</strong>
        Put simply: What combination of stocks, bonds, and options recreates the same payoff
        that we observe with the ESPP? And since each of the components of the replicating
        portfolio can be valued, we will know the value of the ESPP!</p>

      <div class="row">
      <div class="col-sm-5">
        <p>We know from earlier that the payoff chart rises by $150 for each $1 increase in the stock price up to
          the point where we can invest the full $12,500 (i.e., ~$14.70). We can <strong>replicate this payoff by
          buying 150 shares of the stock!</strong> I.e., when the price of the stock goes up by $1, we will gain
          $150 if we have 150 shares.</p>

        <p>But we also need a way to <strong>neutralize that $150 increase beyond the $14.70 mark</strong> — we'll
          do that by <strong>selling call options</strong>.
      </div>
      <div class="col-md-7">
      <canvas id="buy-stock-example"></canvas>
      </div>
      </div>

      <hr>

      <div class="row">
      <div class="col-sm-5">
        <p>A call option is the <strong>option to buy a stock at a given price (known as the 'strike price').</strong></p>
      </div>
      <div class="col-md-7">
      <canvas id="sell-calls-example"></canvas>
      </div>
      </div>

      <hr>

      <div class="row">
      <div class="col-sm-5">
        <p>The final upward kink in the payoff is done by <strong>buying call options.</strong></p>
      </div>
      <div class="col-md-7">
      <canvas id="buy-calls-example"></canvas>
      </div>
      </div>

      <h2>Valuing the replicating portfolio</h2>
      <p>Now, we have a replicating portfolio consisting of
        <ul>
          <li>150 shares of stock</li>
          <li>Negative exposure to 150 call options at a strike price of $14.70</li>
          <li>Positive exposure to TODO call options at a strike price of $28.00</li>
        </ul>
        Valuing the stock is straightforward: 150 shares x $28.00 = $4,200. But what about the call options?
      </p>

      <h3>Valuing call options</h3>
      <p>Diving into the specifics of the Black-Scholes option pricing model is outside the scope of this site. 
        The critical takeaways for our purposes are:
        <ul>
          <li>The lower the call price is relative to the current price, the higher the value of the option</li>
          <li>The higher the volatility of the stock, the higher the value of the option</li>
        </ul>
      </p>

      <div class="row">
      <div class="col-md-5">
        <p>placeholder</p>
      </div>
      <div class="col-md-7">
      <canvas id="portfolioChart"></canvas>
      </div>
      </div>

      <div class="row">
      <div class="col-md-5">
        <p>placeholder</p>
      </div>
      <div class="col-sm-7">
        <canvas id="myChart"></canvas>
      </div>
      </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static "/web/js/chart-config.js" %}"></script>
    <script src="{% static "/web/js/payoff-example.js" %}"></script>
    <script src="{% static "/web/js/middle-example.js" %}"></script>
    <script src="{% static "/web/js/upside-example.js" %}"></script>
    <script src="{% static "/web/js/shares-cap-example.js" %}"></script>
    <script src="{% static "/web/js/buy-stock-example.js" %}"></script>
    <script src="{% static "/web/js/sell-calls-example.js" %}"></script>
    <script src="{% static "/web/js/buy-calls-example.js" %}"></script>
    <script src="{% static "/web/js/get-stock-data.js" %}"></script>
    <script>
      fetch('/payoffs')
        .then(response => response.json())
        .then(data => {
          const prices = data.prices;
          const payoffs = data.payoffs;

          const ctx = document.getElementById('myChart');
          const chart = new Chart(ctx, {
            type: 'line',
            data: {
              labels: prices,
              datasets: [
                  {
                      label: 'payoff',
                      data: payoffs,
                      borderWidth: 1
                  }
              ]
            },
            options: base_options
          });
        });

      fetch('/replicating-portfolio-series')
        .then(response => response.json())
        .then(data => {
          const prices = data.prices;
          const shares_series = data.shares_series;
          const sell_call_options_series = data.sell_call_options_series;
          const buy_call_options_series = data.buy_call_options_series;
          const payoffs = data.payoffs;

          const ctx = document.getElementById('portfolioChart');
          const chart = new Chart(ctx, {
            type: 'line',
            data: {
              labels: prices,
              datasets: [
                  {
                      label: 'shares',
                      data: shares_series,
                      borderWidth: 1
                  },
                  {
                      label: 'sell call options',
                      data: sell_call_options_series,
                      borderWidth: 1
                  },
                  {
                      label: 'buy call options',
                      data: buy_call_options_series,
                      borderWidth: 1
                  },
                  {
                      label: 'espp',
                      data: payoffs,
                      borderWidth: 1
                  }
              ]
            },
            options: base_options
          });
      });
    </script>
  </body>
</html>
